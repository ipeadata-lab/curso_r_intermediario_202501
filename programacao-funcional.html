<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Beatriz Milz">

<title>7&nbsp; Programação funcional – R intermediário e pesquisa reprodutível</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./dados-espaciais.html" rel="next">
<link href="./texto-data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a34d670291f06f286357e447776a572a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R intermediário e pesquisa reprodutível</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Procurar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Alternar de navegação" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-materiais" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Materiais</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-materiais">    
        <li>
    <a class="dropdown-item" href="https://ipeadata-lab.github.io/curso_r_intro_202409/">
 <span class="dropdown-text">Introdução à análise de dados no R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ipeadata-lab.github.io/curso_r_intermediario_202501/">
 <span class="dropdown-text">R intermediário e pesquisa reprodutível</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/ipeadata-lab/curso_r_intermediario_202501" title="Código fonte" class="quarto-navigation-tool px-1" aria-label="Código fonte"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./programacao-funcional.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Programação funcional</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Página inicial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./instalacao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Instalações e outros preparativos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reprodutibilidade.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reprodutibilidade e estruturação de projeto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./relatorios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Produção de relatórios com Quarto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introdução ao controle de versão com Git e GitHub</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./texto-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Manipulação de datas e textos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programacao-funcional.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Programação funcional</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dados-espaciais.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dados espaciais no R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./big-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Introdução à <em>Big Data</em></span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução"><span class="header-section-number">7.1</span> Introdução</a></li>
  <li><a href="#funções-no-r" id="toc-funções-no-r" class="nav-link" data-scroll-target="#funções-no-r"><span class="header-section-number">7.2</span> Funções no R</a>
  <ul>
  <li><a href="#estrutura-básica-de-uma-função" id="toc-estrutura-básica-de-uma-função" class="nav-link" data-scroll-target="#estrutura-básica-de-uma-função"><span class="header-section-number">7.2.1</span> Estrutura básica de uma função</a>
  <ul>
  <li><a href="#exercícios" id="toc-exercícios" class="nav-link" data-scroll-target="#exercícios"><span class="header-section-number">7.2.1.1</span> Exercícios</a></li>
  </ul></li>
  <li><a href="#argumentos-padrão" id="toc-argumentos-padrão" class="nav-link" data-scroll-target="#argumentos-padrão"><span class="header-section-number">7.2.2</span> Argumentos padrão</a>
  <ul>
  <li><a href="#exercícios-1" id="toc-exercícios-1" class="nav-link" data-scroll-target="#exercícios-1"><span class="header-section-number">7.2.2.1</span> Exercícios</a></li>
  </ul></li>
  <li><a href="#verificação-dos-argumentos" id="toc-verificação-dos-argumentos" class="nav-link" data-scroll-target="#verificação-dos-argumentos"><span class="header-section-number">7.2.3</span> Verificação dos argumentos</a>
  <ul>
  <li><a href="#exercícios-2" id="toc-exercícios-2" class="nav-link" data-scroll-target="#exercícios-2"><span class="header-section-number">7.2.3.1</span> Exercícios</a></li>
  </ul></li>
  <li><a href="#environments" id="toc-environments" class="nav-link" data-scroll-target="#environments"><span class="header-section-number">7.2.4</span> Environments</a></li>
  <li><a href="#escopo-de-variáveis-local-vs.-global" id="toc-escopo-de-variáveis-local-vs.-global" class="nav-link" data-scroll-target="#escopo-de-variáveis-local-vs.-global"><span class="header-section-number">7.2.5</span> Escopo de Variáveis (Local vs.&nbsp;Global)</a></li>
  <li><a href="#indo-além-com-funções" id="toc-indo-além-com-funções" class="nav-link" data-scroll-target="#indo-além-com-funções"><span class="header-section-number">7.2.6</span> Indo além com funções</a></li>
  </ul></li>
  <li><a href="#iteração" id="toc-iteração" class="nav-link" data-scroll-target="#iteração"><span class="header-section-number">7.3</span> Iteração</a>
  <ul>
  <li><a href="#loop-for" id="toc-loop-for" class="nav-link" data-scroll-target="#loop-for"><span class="header-section-number">7.3.1</span> Loop <code>for</code></a>
  <ul>
  <li><a href="#exercício" id="toc-exercício" class="nav-link" data-scroll-target="#exercício"><span class="header-section-number">7.3.1.1</span> Exercício</a></li>
  </ul></li>
  <li><a href="#pacote-purrr" id="toc-pacote-purrr" class="nav-link" data-scroll-target="#pacote-purrr"><span class="header-section-number">7.3.2</span> Pacote <code>purrr</code></a>
  <ul>
  <li><a href="#funções-principais-map" id="toc-funções-principais-map" class="nav-link" data-scroll-target="#funções-principais-map"><span class="header-section-number">7.3.2.1</span> Funções principais: <code>map()</code></a></li>
  <li><a href="#exercício-1" id="toc-exercício-1" class="nav-link" data-scroll-target="#exercício-1"><span class="header-section-number">7.3.2.2</span> Exercício</a></li>
  </ul></li>
  <li><a href="#outras-aplicações" id="toc-outras-aplicações" class="nav-link" data-scroll-target="#outras-aplicações"><span class="header-section-number">7.3.3</span> Outras aplicações</a></li>
  <li><a href="#comparação-for-loop-vs.-map" id="toc-comparação-for-loop-vs.-map" class="nav-link" data-scroll-target="#comparação-for-loop-vs.-map"><span class="header-section-number">7.3.4</span> Comparação: <code>for</code> loop vs.&nbsp;<code>map()</code></a></li>
  </ul></li>
  <li><a href="#paralelização" id="toc-paralelização" class="nav-link" data-scroll-target="#paralelização"><span class="header-section-number">7.4</span> Paralelização</a>
  <ul>
  <li><a href="#pacote-furrr" id="toc-pacote-furrr" class="nav-link" data-scroll-target="#pacote-furrr"><span class="header-section-number">7.4.1</span> Pacote <code>furrr</code></a>
  <ul>
  <li><a href="#configuração" id="toc-configuração" class="nav-link" data-scroll-target="#configuração"><span class="header-section-number">7.4.1.1</span> Configuração</a></li>
  <li><a href="#utilizando-o-furrr" id="toc-utilizando-o-furrr" class="nav-link" data-scroll-target="#utilizando-o-furrr"><span class="header-section-number">7.4.1.2</span> Utilizando o <code>furrr</code></a></li>
  <li><a href="#exercício-2" id="toc-exercício-2" class="nav-link" data-scroll-target="#exercício-2"><span class="header-section-number">7.4.1.3</span> Exercício</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#material-complementar" id="toc-material-complementar" class="nav-link" data-scroll-target="#material-complementar"><span class="header-section-number">7.5</span> Material complementar</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Programação funcional</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autoria</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://www.beamilz.com/">Beatriz Milz</a> <a href="mailto:milz.bea@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introdução" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="introdução"><span class="header-section-number">7.1</span> Introdução</h2>
<p>A programação funcional é um paradigma de programação que se concentra em funções e em como elas são usadas para resolver problemas<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>Utilizar funções tem várias vantagens, como:</p>
<ul>
<li><p>Evitamos copiar e colar o mesmo código (ou muito parecido) várias vezes. Isso faz com que o código seja mais fácil de manter e de entender, e também diminui a chance de erros.</p></li>
<li><p>Podemos reutilizar o código em diferentes partes do programa.</p></li>
</ul>
<p>Até, nós temos utilizado as funções existentes (do R e de pacotes) para realizar tarefas específicas.</p>
<p>Mas e se quisermos criar nossas próprias funções, para facilitar a execução de tarefas repetitivas?</p>
<p>Nesta aula, vamos aprender a criar nossas próprias funções!</p>
<p>Vamos carregar os dados dos voos (utilizado na aula anterior) para utilizarmos como exemplo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>voos <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(<span class="st">"dados/voos_dez-2024-alterado.csv"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 82003 Columns: 26
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr  (17): nm_empresa, ds_di, ds_grupo_di, ds_natureza_etapa, dt_partida_rea...
dbl   (5): id_basica, id_empresa, id_aerodromo_origem, dt_chegada_real, id_a...
dttm  (1): dt_sistema
date  (1): dt_referencia
time  (2): hr_partida_real, hr_chegada_real

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Caso tenha dificuldades em carregar os dados, você pode carregar o arquivo diretamente da internet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>voos <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(<span class="st">"https://github.com/ipeadata-lab/curso_r_intermediario_202501/raw/refs/heads/main/dados/voos_dez-2024-alterado.csv"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="funções-no-r" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="funções-no-r"><span class="header-section-number">7.2</span> Funções no R</h2>
<p>Já vimos que o R possui várias funções embutidas, como <code>mean()</code>, <code>sum()</code>, <code>sd()</code>, entre outras. Também já utilizamos funções de pacotes, como <code>dplyr::filter()</code> e <code>ggplot2::ggplot()</code>.</p>
<p>Mas e se quisermos criar nossas próprias funções?</p>
<section id="estrutura-básica-de-uma-função" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="estrutura-básica-de-uma-função"><span class="header-section-number">7.2.1</span> Estrutura básica de uma função</h3>
<p>As funções no R são criadas com a função <code>function()</code>, e tem a seguinte estrutura básica:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nome_da_funcao <span class="ot">&lt;-</span> <span class="cf">function</span>(argumento1, argumento2, ...) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Corpo da função</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aqui, escrevemos o código que a função irá executar</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Uma forma que facilita o processo de criação de funções é pensar em pequenas tarefas que podem ser agrupadas em uma função. Assim, a função se torna mais fácil de entender e de testar.</p>
<p>Por exemplo, na aula de <a href="./relatorios.html">relatórios com Quarto</a>, utilizamos a função knitr::combine_words() para combinar palavras em uma frase. Se quisermos criar uma função que faça isso, poderíamos seguir os seguintes passos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-1" class="code-annotation-target"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a>combinar_palavras <span class="ot">&lt;-</span> <span class="cf">function</span>(vetor_de_palavras) {</span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-3" class="code-annotation-target"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>  palavras_unicas <span class="ot">&lt;-</span> <span class="fu">unique</span>(vetor_de_palavras)</span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-5" class="code-annotation-target"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a>  palavras_combinadas <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">combine_words</span>(</span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a>    palavras_unicas,</span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">and =</span> <span class="st">" e "</span>,</span>
<span id="annotated-cell-4-8"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">oxford_comma =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="4">4</button><span id="annotated-cell-4-10" class="code-annotation-target"><a href="#annotated-cell-4-10" aria-hidden="true" tabindex="-1"></a>  palavras_combinadas</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="5">5</button><span id="annotated-cell-4-11" class="code-annotation-target"><a href="#annotated-cell-4-11" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="1" data-code-annotation="1">Início da função <code>combinar_palavras()</code>. A função recebe um argumento chamado <code>vetor_de_palavras</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="3" data-code-annotation="2">O argumento <code>vetor_de_palavras</code> é utilizado como argumento para a função <code>unique()</code> para obter as palavras únicas do vetor de palavras.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="5,8" data-code-annotation="3">As palavras únicas são combinadas utilizando a função <code>knitr::combine_words()</code>. Neste caso, estamos utilizando o argumento <code>and</code> para separar as palavras e <code>oxford_comma</code> para definir se queremos a vírgula de Oxford.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="10" data-code-annotation="4">O resultado da função é a variável <code>palavras_combinadas</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="11" data-code-annotation="5">Fim da função <code>combinar_palavras()</code>.</span>
</dd>
</dl>
</div>
</div>
<p>Com a função criada, podemos experimentá-la:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimentando com um vetor de palavras</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">combinar_palavras</span>(<span class="fu">c</span>(<span class="st">"R"</span>, <span class="st">"Python"</span>, <span class="st">"SQL"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R, Python e SQL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimentando com um vetor de palavras, com palavras repetidas</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">combinar_palavras</span>(<span class="fu">c</span>(<span class="st">"R"</span>, <span class="st">"Python"</span>, <span class="st">"SQL"</span>, <span class="st">"R"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R, Python e SQL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimentando com uma coluna de um data frame</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">combinar_palavras</span>(voos<span class="sc">$</span>sg_uf_origem)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NA, SP, RJ, SC, PE, CE, MG, AM, MT, DF, PR, PA, ES, RS, AC, BA, SE, GO, PB, RN, AL, AP, MS, PI, RR, MA, TO e RO</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O que acontece quando tentamos chamar a função sem argumentos?</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">combinar_palavras</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in combinar_palavras(): argumento "vetor_de_palavras" ausente, sem padrão</code></pre>
</div>
</div>
<p>No exemplo acima, podemos observar que:</p>
<ul>
<li><p><strong>Nome da função:</strong> Criamos uma função chamada <code>combinar_palavras()</code>. Utilizamos o operador <code>&lt;-</code> para atribuir a função a um objeto chamado <code>combinar_palavras</code>.</p></li>
<li><p>A função recebe um <strong>argumento</strong> chamado <code>vetor_de_palavras</code>. Este argumento é o que vamos passar para a função quando quisermos utilizá-la.</p></li>
<li><p>O valor passado no argumento <code>vetor_de_palavras</code> é substituído no <strong>corpo da função</strong> para realizar as operações desejadas.</p></li>
<li><p>Podemos utilizar funções existentes dentro de outras funções. No exemplo, utilizamos a função <code>unique()</code> para obter as palavras únicas e a função <code>knitr::combine_words()</code> para combinar as palavras.</p></li>
<li><p>O resultado da função é o valor da última expressão avaliada. Neste caso, o resultado é a variável <code>palavras_combinadas</code>.</p></li>
<li><p>Podemos chamar a função com diferentes argumentos, como um vetor de palavras ou uma coluna de um data frame. No entanto, se tentarmos chamar a função sem argumentos, obteremos um erro.</p></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dica
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dica: Quando começamos a criar funções, podemos partir de um código que já temos e que gostaríamos de reutilizar. Assim, podemos identificar as partes do código que podem ser agrupadas em uma função.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>A função <code>combinar_palavras()</code> recebe um vetor com <code>n</code> palavras, e retorna um vetor de tamanho <code>1</code> com a frase combinada.</p>
<p>Chamamos este tipo de função de <a href="https://r4ds.hadley.nz/functions.html#summary-functions">função de sumarização (summary function)</a>, pois ela “resume” as <code>n</code> palavras em uma única frase.</p>
<p>Outros exemplos de função de sumarização são <code>mean()</code>, <code>sum()</code>, <code>sd()</code>, <code>median()</code>, entre outras: elas recebem um vetor de números (que pode conter muitos números) e retornam um único número.</p>
</div>
</div>
<section id="exercícios" class="level4" data-number="7.2.1.1">
<h4 data-number="7.2.1.1" class="anchored" data-anchor-id="exercícios"><span class="header-section-number">7.2.1.1</span> Exercícios</h4>
<ol type="1">
<li>Criar uma função simples!</li>
</ol>
<!-- -->
<ol type="a">
<li>Crie uma função que recebe um valor em dólar e retorna o valor em reais. Considere que 1 dólar é igual a R$ 5,77 (ou consulte o <a href="https://www.bcb.gov.br/estabilidadefinanceira/historicocotacoes">site do Banco Central</a> para buscar o valor atualizado).</li>
<li>Experimente a função com diferentes valores.</li>
</ol>
<ol start="2" type="1">
<li>Na aula passada, falamos sobre tratar textos. O exemplo abaixo mostra como a função <code>stringi::stri_trans_general()</code> pode ser utilizada para remover acentos de palavras.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>stringi<span class="sc">::</span><span class="fu">stri_trans_general</span>(<span class="st">"RIBEIRÃO PRETO"</span>, <span class="st">"Latin-ASCII"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RIBEIRAO PRETO"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>stringi<span class="sc">::</span><span class="fu">stri_trans_general</span>(<span class="st">"SÃO PAULO"</span>, <span class="st">"Latin-ASCII"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SAO PAULO"</code></pre>
</div>
</div>
<p>Repare que o segundo argumento da função é um pouco complicado de lembrar. Podemos “encapsular” essa função em uma função mais simples, que recebe apenas a palavra a ser transformada.</p>
<ol type="a">
<li>Crie uma função chamada <code>remover_acentos()</code> que recebe um vetor de palavras e retorna as palavras sem acentos.</li>
<li>Experimente a função com outras palavras que possuem acentos.</li>
</ol>
<!-- -->
<ol start="3" type="1">
<li>Considerando a função <code>combinar_palavras()</code> criada anteriormente:</li>
</ol>
<!-- -->
<ol type="a">
<li>Adapte a função para que ordene as palavras (<code>sort()</code>) e remova os <code>NA</code> (<code>na.omit()</code>) antes de combiná-las. Dê o nome para a função de <code>combinar_palavras_sem_na()</code>.</li>
<li>Experimente a função com o vetor <code>voos$sg_uf_origem</code>. Qual é a diferença no resultado das funções <code>combinar_palavras()</code> e <code>combinar_palavras_sem_na()</code>?</li>
</ol>
</section>
</section>
<section id="argumentos-padrão" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="argumentos-padrão"><span class="header-section-number">7.2.2</span> Argumentos padrão</h3>
<p>No exemplo anterior, a função <code>combinar_palavras()</code> não funcionará se não fornecermos um argumento. Isso acontece porque o argumento <code>vetor_de_palavras</code> não tem um valor padrão.</p>
<p>Podemos definir argumentos padrão para uma função, que serão utilizados caso o argumento não seja fornecido.</p>
<p>Vamos explorar este conceito com uma função do base R: <code>round()</code>. Essa função apresenta dois argumentos: <code>x</code> (o número que queremos arredondar) e <code>digits</code> (o número de casas decimais para arredondar).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos chamar a função round() com os dois argumentos</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(pi, <span class="at">digits =</span> <span class="dv">2</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(pi, <span class="at">digits =</span> <span class="dv">1</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou podemos chamar a função com apenas o argumento x</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(pi) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>Repare que, quando chamamos a função <code>round()</code> sem o argumento <code>digits</code>, o valor padrão é utilizado (<code>0</code>). Ou seja, o número é arredondado para o inteiro mais próximo. Este argumento padrão é definido na própria função <code>round()</code>, e podemos consultar a documentação as funções para descobrir quais são os argumentos padrão.</p>
<p>Entretanto, a função <code>round()</code> tem um argumento obrigatório: <code>x</code>. Ou seja, precisamos fornecer um valor para <code>x</code> sempre que chamamos a função. Caso contrário, a função não saberá o que arredondar, e retornará um erro.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: argumento "x" ausente, sem padrão</code></pre>
</div>
</div>
<p>Portanto, quando estamos criando nossas próprias funções, é importante pensar em quais argumentos são obrigatórios e quais são opcionais (ou seja, com valores padrão). Assim, podemos definir argumentos padrão para tornar a função mais flexível e fácil de usar.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>A função <code>round()</code> recebe um vetor com <code>n</code> números, e retorna um vetor de tamanho <code>n</code> com os números arredondados. Ou seja, a função <code>round()</code> retorna um vetor do mesmo tamanho do vetor de entrada.</p>
<p>Chamamos este tipo de função de <a href="https://r4ds.hadley.nz/functions.html#mutate-functions">mutate functions</a>, pois ela “transforma” os <code>n</code> números em <code>n</code> números arredondados. As funções do tipo <code>mutate</code> são interessantes pois podemos utilizar dentro de um <code>mutate()</code> do pacote <code>dplyr</code>.</p>
</div>
</div>
<section id="exercícios-1" class="level4" data-number="7.2.2.1">
<h4 data-number="7.2.2.1" class="anchored" data-anchor-id="exercícios-1"><span class="header-section-number">7.2.2.1</span> Exercícios</h4>
<ol type="1">
<li>No exercício 1 da seção anterior, criamos uma função para converter valores em dólar para reais.</li>
</ol>
<!-- -->
<ol type="a">
<li>Modifique a função para que o valor do dólar seja um argumento padrão. O valor padrão deve ser 5,77.</li>
<li>Experimente a função, calculando o valor de um mesmo produto com diferentes valores de dólar. Por exemplo: no dia 02/01/2025, o valor do dólar era 6,19. Qual seria o valor do produto nesse dia? E qual seria o valor do produto hoje?</li>
</ol>
<!-- -->
<ol start="2" type="1">
<li><p>Para a função <code>combinar_palavras()</code> criada anteriormente, faz sentido ter um argumento padrão? Se sim, qual seria esse argumento padrão?</p></li>
<li><p>Uma aplicação útil para as funções do <code>{stringr}</code> é preparar uma coluna para ser utilizada em um <code>join</code>. Por exemplo, podemos remover acentos e transformar todas as letras em minúsculas.</p></li>
</ol>
<!-- -->
<ol type="a">
<li>Crie uma função chamada <code>preparar_coluna()</code> que recebe um vetor (uma coluna da tabela) e retorna esse vetor sem acentos e em minúsculas.</li>
<li>Experimente a função com a coluna <code>voos$nm_municipio_origem</code>: <code>preparar_coluna(voos$nm_municipio_origem)</code>.</li>
<li>Experimente utilizar a função <code>preparar_coluna()</code> dentro de um <code>mutate()</code> do pacote <code>dplyr</code> para criar uma nova coluna <code>nm_municipio_origem_preparado</code> na tabela <code>voos</code>.</li>
</ol>
</section>
</section>
<section id="verificação-dos-argumentos" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="verificação-dos-argumentos"><span class="header-section-number">7.2.3</span> Verificação dos argumentos</h3>
<p>Quando criamos funções, é importante verificar se os argumentos fornecidos são válidos. Por exemplo, se a função espera um vetor de números, mas recebe um vetor de caracteres, a função pode gerar um erro ou retornar um resultado inesperado.</p>
<p>Para isso, é importante lembrar das funções do R Base que podem nos ajudar a verificar se um objeto é de um determinado tipo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">is.logical</span>()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># is.***()</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Outra função útil é a <code>stop()</code> que pode ser utilizada para interromper a execução da função e gerar um erro:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stop</span>(<span class="st">"Mensagem de erro"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: Mensagem de erro</code></pre>
</div>
</div>
<p>A função <code>stopifnot()</code> é uma forma mais prática de verificar se uma condição é verdadeira. Se a condição for falsa, a função gera um erro. Uma desvantagem é que essa função não permite personalizar a mensagem de erro.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">is.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: is.character(1:10) não é TRUE</code></pre>
</div>
</div>
<p>Por exemplo, podemos adicionar uma verificação ao início da função <code>combinar_palavras()</code> para garantir que o argumento fornecido é um vetor:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>combinar_palavras_com_verificacao <span class="ot">&lt;-</span> <span class="cf">function</span>(vetor_de_palavras) {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.vector</span>(vetor_de_palavras))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  palavras_unicas <span class="ot">&lt;-</span> <span class="fu">unique</span>(vetor_de_palavras)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  palavras_combinadas <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">combine_words</span>(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    palavras_unicas,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">and =</span> <span class="st">" e "</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">oxford_comma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  palavras_combinadas</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos experimentar a função com diferentes argumentos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">combinar_palavras_com_verificacao</span>(<span class="st">"R"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">combinar_palavras_com_verificacao</span>(<span class="fu">c</span>(<span class="st">"R"</span>, <span class="st">"Python"</span>, <span class="st">"SQL"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R, Python e SQL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">combinar_palavras_com_verificacao</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1, 2, 3, 4, 5, 6, 7, 8, 9 e 10</code></pre>
</div>
</div>
<p>Experimentando a função utilizando um data frame como argumento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">combinar_palavras_com_verificacao</span>(mtcars)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in combinar_palavras_com_verificacao(mtcars): is.vector(vetor_de_palavras) não é TRUE</code></pre>
</div>
</div>
<p>As funções <code>stop()</code> e <code>stopifnot()</code> são do R Base, mas existem pacotes que facilitam a verificação de argumentos, como o pacote <code>assertthat</code>.</p>
<p>O interessante do pacote <a href="https://github.com/hadley/assertthat"><code>{assertthat}</code></a> é que ele gera mensagens de erro mais úteis, e também permite personalizá-las, o que pode ser útil para indicar ao usuário o que deu errado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">is.vector</span>(mtcars))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: mtcars is not an atomic vector without attributes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">is.vector</span>(mtcars),</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">msg =</span> <span class="st">"O argumento fornecido não é um vetor."</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: O argumento fornecido não é um vetor.</code></pre>
</div>
</div>
<section id="exercícios-2" class="level4" data-number="7.2.3.1">
<h4 data-number="7.2.3.1" class="anchored" data-anchor-id="exercícios-2"><span class="header-section-number">7.2.3.1</span> Exercícios</h4>
<ol type="1">
<li>Modifique a função <code>converter_dolar_para_real()</code> para que ela verifique se os argumentos fornecidos são válidos. A função deve aceitar apenas valores numéricos.</li>
</ol>
</section>
</section>
<section id="environments" class="level3" data-number="7.2.4">
<h3 data-number="7.2.4" class="anchored" data-anchor-id="environments"><span class="header-section-number">7.2.4</span> Environments</h3>
<p>Em R, um conceito importante que pode nos ajudar a entender problemas que ocorrem ao criar funções (e as boas práticas) é o de <em>environment</em>. Entretanto, <a href="https://adv-r.hadley.nz/environments.html">este assunto é avançado</a>, e vamos apresentar de forma simplificada.</p>
<p>Já ouvimos falar de <em>Enviroment</em> ao utilizar o RStudio, no painel <em>Enviroment</em>. Quando criamos um objeto, o R adiciona este objeto no <em>Global Environment</em> e conseguimos visualizar este objeto no painel <em>Enviroment</em>.</p>
<p>Mas o que acontece quando tentamos acessar um objeto que não aparece no <em>Global Environment</em>?</p>
<p>Por exemplo, se tentarmos acessar o objeto <code>mtcars</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
</div>
<p>O R encontrou este objeto, mesmo não estando no <em>Global Environment</em>. Isso acontece porque o R procura primeiramente o objeto no <em>Global Environment</em>, e se não encontrar, ele procura em outros <em>environments</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://adv-r.hadley.nz/environments.html"><img src="images/search-path.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Imagem do livro “Advanced R” por Hadley Wickham"></a></p>
</figure>
</div>
<figcaption>Imagem do livro “Advanced R” por Hadley Wickham</figcaption>
</figure>
</div>
<p>A função <code>search()</code> nos mostra a ordem em que o R procura por objetos. Vamos experimentar:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] ".GlobalEnv"        "package:stats"     "package:graphics" 
 [4] "package:grDevices" "package:datasets"  "renv:shims"       
 [7] "package:utils"     "package:methods"   "Autoloads"        
[10] "package:base"     </code></pre>
</div>
</div>
<p>E por que isso é importante para criar funções?</p>
</section>
<section id="escopo-de-variáveis-local-vs.-global" class="level3" data-number="7.2.5">
<h3 data-number="7.2.5" class="anchored" data-anchor-id="escopo-de-variáveis-local-vs.-global"><span class="header-section-number">7.2.5</span> Escopo de Variáveis (Local vs.&nbsp;Global)</h3>
<p>Quando executamos funções, o R cria um <em>enviroment</em> temporário para execução para a função. Este <em>environment</em> é onde as variáveis criadas dentro da função são armazenadas. Vamos chamar de <em>escopo local</em>.</p>
<p>Existem dois tipos principais de escopo:</p>
<ul>
<li><p><strong>Escopo Local:</strong> Variáveis criadas dentro de uma função existem apenas enquanto a função está em execução. Elas não afetam o ambiente global (<em>global environment</em>) e são descartadas após a execução da função. Isso garante que o código seja mais seguro e previsível, já que alterações em variáveis locais não influenciam outros trechos do código.</p></li>
<li><p><strong>Escopo Global:</strong> Variáveis definidas fora de funções estão no ambiente global (<em>global environment</em>) e podem ser acessadas de qualquer lugar do código. No entanto, confiar em variáveis globais dentro de funções pode gerar dependências implícitas, dificultando a compreensão e a depuração do código.</p></li>
</ul>
<p>Quando uma função precisa de um objeto que não está definido em seu escopo local (ou seja, não foi criada dentro da função ou recebida como um argumento), o R inicia uma busca nos ambientes acima, até encontrar o objeto ou gerar um erro caso ele não exista. Esse comportamento pode causar efeitos inesperados, especialmente se o objeto global for alterado em outro lugar do código.</p>
<p>Por exemplo, considere a seguinte função:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>contagem_coluna <span class="ot">&lt;-</span> <span class="cf">function</span>(coluna){</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  voos <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(.data[[coluna]], <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimentando a função: UF de origem</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contagem_coluna</span>(<span class="st">"sg_uf_origem"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 2
   sg_uf_origem     n
   &lt;chr&gt;        &lt;int&gt;
 1 SP           26358
 2 RJ            7434
 3 &lt;NA&gt;          7228
 4 MG            5969
 5 DF            4531
 6 PE            3976
 7 BA            3787
 8 PR            3586
 9 SC            2785
10 RS            2028
# ℹ 18 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimentando a função: município de origem</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contagem_coluna</span>(<span class="st">"nm_municipio_origem"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 299 × 2
   nm_municipio_origem      n
   &lt;chr&gt;                &lt;int&gt;
 1 GUARULHOS            11809
 2 SÃO PAULO             8104
 3 RIO DE JANEIRO        7345
 4 CAMPINAS              5210
 5 CONFINS               4788
 6 BRASÍLIA              4524
 7 RECIFE                3506
 8 SALVADOR              2449
 9 SÃO JOSÉ DOS PINHAIS  2069
10 PORTO ALEGRE          1716
# ℹ 289 more rows</code></pre>
</div>
</div>
<p>O que acontece se tentarmos executar a função <code>contagem_coluna()</code>? Observe que estamos usando a base de dados <code>voos</code> dentro da função, mas ela não foi passada como argumento.</p>
<p>E ao executar a função, ela não gerou erro!! Isso acontece porque o R procura primeiro no ambiente local, depois no ambiente global, e encontra a base de dados <code>voos</code> no ambiente global. E como a base de dados <code>voos</code> foi carregada no ambiente global, a função consegue acessá-la. Se o objeto <code>voos</code> não existisse, a função geraria um erro.</p>
<p>O ideal seria deixar a base de dados <code>voos</code> como argumento da função, para que ela seja mais flexível e independente do ambiente global.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>contagem_coluna_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(df, coluna){</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(.data[[coluna]], <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimentando a função: UF de origem</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">contagem_coluna_2</span>(voos, <span class="st">"sg_uf_origem"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 2
   sg_uf_origem     n
   &lt;chr&gt;        &lt;int&gt;
 1 SP           26358
 2 RJ            7434
 3 &lt;NA&gt;          7228
 4 MG            5969
 5 DF            4531
 6 PE            3976
 7 BA            3787
 8 PR            3586
 9 SC            2785
10 RS            2028
# ℹ 18 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimentando a função: município de origem</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contagem_coluna_2</span>(voos, <span class="st">"nm_municipio_origem"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 299 × 2
   nm_municipio_origem      n
   &lt;chr&gt;                &lt;int&gt;
 1 GUARULHOS            11809
 2 SÃO PAULO             8104
 3 RIO DE JANEIRO        7345
 4 CAMPINAS              5210
 5 CONFINS               4788
 6 BRASÍLIA              4524
 7 RECIFE                3506
 8 SALVADOR              2449
 9 SÃO JOSÉ DOS PINHAIS  2069
10 PORTO ALEGRE          1716
# ℹ 289 more rows</code></pre>
</div>
</div>
<p>Também é uma boa prática evitar alterar objetos fora do ambiente de execução da função. Funções devem ser “puras”, ou seja, receber entradas e retornar saídas sem efeitos colaterais externos. Em outras palavras, não devem alterar objetos fora de seu escopo local.</p>
<p>Além disso, ao utilizar pacotes dentro de funções, o ideal é usar a notação <code>::</code> (por exemplo, <code>dplyr::filter()</code>) em vez de <code>library()</code>. Isso porque <code>library()</code> altera o ambiente global, carregando o pacote para todo o script, enquanto <code>::</code> garante que a função específica seja chamada diretamente do pacote desejado, sem afetar o restante do código. Isso melhora a legibilidade e evita conflitos entre funções de diferentes pacotes.</p>
</section>
<section id="indo-além-com-funções" class="level3" data-number="7.2.6">
<h3 data-number="7.2.6" class="anchored" data-anchor-id="indo-além-com-funções"><span class="header-section-number">7.2.6</span> Indo além com funções</h3>
<p>Nesta aula, apresentamos uma introdução sobre como criar funções no R. Criar funções é uma habilidade importante para tornar o código mais organizado, reutilizável e fácil de manter, e para melhorar essa habilidade é <strong>preciso praticar</strong>!</p>
<p>Uma dica é tentar criar funções para tarefas repetitivas que você realiza com frequência.</p>
<p>O <a href="https://pt.r4ds.hadley.nz/functions.html">capítulo sobre funções do livro R for Data Science (2ed)</a> é uma ótima referência para aprender mais sobre funções no R.</p>
</section>
</section>
<section id="iteração" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="iteração"><span class="header-section-number">7.3</span> Iteração</h2>
<p>Na seção anterior, aprendemos a criar funções para facilitar a execução de tarefas repetitivas. No entanto, às vezes precisamos executar a mesma operação em vários elementos de uma lista, vetor ou data frame.</p>
<p>Imagine que queremos salvar arquivos CSV separados para cada uma das empresas aéreas no dataset <code>voos</code>. Podemos criar uma função que salva um arquivo CSV para uma empresa específica:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>salvar_csv_por_empresa <span class="ot">&lt;-</span> <span class="cf">function</span>(nome_empresa,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                                   dados,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">dir_salvar =</span> <span class="st">"dados/voos_empresas/"</span>) {</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verificar se os argumentos são válidos</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.data.frame</span>(dados))</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(nome_empresa))</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(nome_empresa) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(dir_salvar))</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limpar o nome da empresa</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  nome_empresa_limpo <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">make_clean_names</span>(nome_empresa)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Criando o diretório para salvar os arquivos</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  fs<span class="sc">::</span><span class="fu">dir_create</span>(dir_salvar)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compor o caminho do arquivo a ser salvo</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  caminho_arquivo_salvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir_salvar, nome_empresa_limpo, <span class="st">".csv"</span>)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar os dados para a empresa desejada</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  dados_filtrados <span class="ot">&lt;-</span> dados <span class="sc">|&gt;</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(nm_empresa <span class="sc">==</span> nome_empresa)</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Salvar os dados em um arquivo CSV</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_csv2</span>(dados_filtrados, <span class="at">file =</span> caminho_arquivo_salvar)</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apresentar uma mensagem ao usuário</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  usethis<span class="sc">::</span><span class="fu">ui_done</span>(<span class="st">"Arquivo salvo: {caminho_arquivo_salvar}"</span>)</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retornar o caminho do arquivo salvo</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  caminho_arquivo_salvar</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se quisermos salvar arquivos CSV separados para uma empresa, podemos utilizar a função <code>salvar_csv_por_empresa()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">salvar_csv_por_empresa</span>(<span class="at">nome_empresa =</span> <span class="st">"TAM LINHAS AÉREAS S.A."</span>, <span class="at">dados =</span> voos)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Arquivo salvo: dados/voos_empresas/tam_linhas_aereas_s_a.csv</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "dados/voos_empresas/tam_linhas_aereas_s_a.csv"</code></pre>
</div>
</div>
<p>A função <code>salvar_csv_por_empresa()</code> não aceita um vetor com nome de várias empresas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">salvar_csv_por_empresa</span>(<span class="at">nome_empresa =</span>  <span class="fu">c</span>(<span class="st">"AZUL LINHAS AÉREAS BRASILEIRAS S/A"</span>,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"TAM LINHAS AÉREAS S.A."</span>),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">dados =</span> voos)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in salvar_csv_por_empresa(nome_empresa = c("AZUL LINHAS AÉREAS BRASILEIRAS S/A", : length(nome_empresa) == 1 não é TRUE</code></pre>
</div>
</div>
<p>Uma forma de resolver esse problema seria chamar a função <code>salvar_csv_por_empresa()</code> para cada empresa. Porém essa base de dados apresenta mais de 200 valores únicos para a variável <code>nm_empresa</code>. Isso tornaria o processo manual e demorado (e com maior chance de erros!)</p>
<p>Uma forma de resolver esse problema é utilizando alguma técnica de iteração. No R base, podemos utilizar o <em>loop</em> <code>for</code> para iterar sobre os valores de um vetor ou lista. No entanto, o pacote <code>purrr</code> oferece funções mais flexíveis e fáceis de usar para iterar sobre elementos.</p>
<p>Vamos explorar algumas técnicas para fazer isso!</p>
<section id="loop-for" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="loop-for"><span class="header-section-number">7.3.1</span> Loop <code>for</code></h3>
<p>Os <em>loops</em> <code>for</code> são utilizados para iterar (ou seja, repetir o mesmo bloco de código) sobre sequências, como vetores, listas e data frames.</p>
<p>No R, a sintaxe básica de um <em>loop</em> <code>for</code> é:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (variavel <span class="cf">in</span> sequencia) {</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Código a ser executado</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Onde:</p>
<ul>
<li><p><code>sequencia</code> é a sequência de valores sobre a qual o <em>loop</em> será executado. Pode ser um vetor ou uma lista.</p></li>
<li><p><code>variavel</code> é a variável que será utilizada a cada iteração do <em>loop</em>. Esse nome será substituído pelos valores da sequência a cada iteração.</p></li>
<li><p>O bloco de código a ser executado é delimitado por chaves <code>{}</code>.</p></li>
</ul>
<p>Considerando o exemplo anterior, podemos usar um <em>loop</em> <code>for</code> para salvar arquivos CSV separados para cada uma das empresas aéreas no dataset <code>voos</code>. Primeiro, vamos criar um vetor com os nomes das 10 empresas com mais voos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>nome_empresas <span class="ot">&lt;-</span> voos <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(nm_empresa, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span> (<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(nm_empresa)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora, podemos utilizar um <em>loop</em> <code>for</code> para salvar arquivos CSV para cada empresa:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (empresa <span class="cf">in</span> nome_empresas) {</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">salvar_csv_por_empresa</span>(<span class="at">nome_empresa =</span> empresa,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dados =</span> voos)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Arquivo salvo: dados/voos_empresas/azul_linhas_aereas_brasileiras_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/tam_linhas_aereas_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/gol_linhas_aereas_s_a_ex_vrg_linhas_aereas_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/azul_conecta_ltda_ex_two_taxi_aereo_ltda.csv
✔ Arquivo salvo: dados/voos_empresas/passaredo_transportes_aereos_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/tap_transportes_aereos_portugueses_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/latam_airlines_group_ex_lan_airlines_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/compania_panamena_de_aviacion_s_a_copa_airlines.csv
✔ Arquivo salvo: dados/voos_empresas/aerolineas_argentinas_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/american_airlines_inc.csv</code></pre>
</div>
</div>
<p>Repare como o <em>loop</em> <code>for</code> é utilizado para iterar sobre os valores do vetor <code>nome_empresas</code> e executar a função <code>salvar_csv_por_empresa()</code> para cada empresa.</p>
<section id="exercício" class="level4" data-number="7.3.1.1">
<h4 data-number="7.3.1.1" class="anchored" data-anchor-id="exercício"><span class="header-section-number">7.3.1.1</span> Exercício</h4>
<ol type="1">
<li>Observe o código abaixo. O que cada parte do código faz? Tente entender o que ele faz antes de executá-lo. O que acontece quando executamos o código?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="pacote-purrr" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="pacote-purrr"><span class="header-section-number">7.3.2</span> Pacote <code>purrr</code></h3>
<p><img src="images/logo-purrr.png" class="img-rstudio" align="right" width="120px"></p>
<p>O pacote <a href="https://purrr.tidyverse.org/"><code>purrr</code></a> faz parte do <a href="https://www.tidyverse.org/"><code>{tidyverse}</code></a> e oferece ferramentas para trabalhar com programação funcional em R.</p>
<p>As funções do tidyverse são projetadas para funcionar bem com o pipe (<code>%&gt;%</code> ou <code>|&gt;</code>), o que torna o código mais legível e fácil de entender. Repare que as funções do <code>tidyverse</code> recebem os dados no primeiro argumento, o que facilita a utilização do pipe.</p>
<p>As funções do <code>purrr</code> também são projetadas para trabalhar com o pipe, o que facilita a integração com outras funções do tidyverse.</p>
<section id="funções-principais-map" class="level4" data-number="7.3.2.1">
<h4 data-number="7.3.2.1" class="anchored" data-anchor-id="funções-principais-map"><span class="header-section-number">7.3.2.1</span> Funções principais: <code>map()</code></h4>
<p>Uma das funções mais utilizadas do <code>purrr</code> é a função <code>map()</code>. A função <code>map()</code> é utilizada para aplicar uma função a cada elemento de uma lista ou vetor, e retorna uma lista com os resultados.</p>
<p>Existem várias variações da função <code>map()</code>, porém o ideal é começar com a função <code>map()</code> e, conforme for se familiarizando com o pacote, explorar as outras funções.</p>
<p>A sintaxe básica da função <code>map()</code> é:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> vetor_para_iterar,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">.f =</span> funcao_que_queremos_aplicar)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sendo que:</p>
<ul>
<li><p><code>.x</code> é argumento que recebe o vetor ou lista que queremos iterar.</p></li>
<li><p><code>.f</code> é argumento que recebe a função que queremos aplicar a cada elemento de <code>.x</code>.</p></li>
<li><p>Essa função também aceita argumentos adicionais que serão passados para a função <code>.f</code>.</p></li>
</ul>
<p>Vamos utilizar a função <code>map()</code> para realizar a mesma tarefa que fizemos com o <em>loop</em> <code>for</code> anteriormente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>nome_empresas <span class="ot">&lt;-</span> voos <span class="sc">|&gt;</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(nm_empresa, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span> (<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(nm_empresa)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(nome_empresas,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>           salvar_csv_por_empresa,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">dados =</span> voos,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">.progress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Arquivo salvo: dados/voos_empresas/azul_linhas_aereas_brasileiras_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/tam_linhas_aereas_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/gol_linhas_aereas_s_a_ex_vrg_linhas_aereas_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/azul_conecta_ltda_ex_two_taxi_aereo_ltda.csv
✔ Arquivo salvo: dados/voos_empresas/passaredo_transportes_aereos_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/tap_transportes_aereos_portugueses_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/latam_airlines_group_ex_lan_airlines_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/compania_panamena_de_aviacion_s_a_copa_airlines.csv
✔ Arquivo salvo: dados/voos_empresas/aerolineas_argentinas_s_a.csv
✔ Arquivo salvo: dados/voos_empresas/american_airlines_inc.csv</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "dados/voos_empresas/azul_linhas_aereas_brasileiras_s_a.csv"

[[2]]
[1] "dados/voos_empresas/tam_linhas_aereas_s_a.csv"

[[3]]
[1] "dados/voos_empresas/gol_linhas_aereas_s_a_ex_vrg_linhas_aereas_s_a.csv"

[[4]]
[1] "dados/voos_empresas/azul_conecta_ltda_ex_two_taxi_aereo_ltda.csv"

[[5]]
[1] "dados/voos_empresas/passaredo_transportes_aereos_s_a.csv"

[[6]]
[1] "dados/voos_empresas/tap_transportes_aereos_portugueses_s_a.csv"

[[7]]
[1] "dados/voos_empresas/latam_airlines_group_ex_lan_airlines_s_a.csv"

[[8]]
[1] "dados/voos_empresas/compania_panamena_de_aviacion_s_a_copa_airlines.csv"

[[9]]
[1] "dados/voos_empresas/aerolineas_argentinas_s_a.csv"

[[10]]
[1] "dados/voos_empresas/american_airlines_inc.csv"</code></pre>
</div>
</div>
<p>Repare que o retorno da função <code>map()</code> é uma <strong>lista</strong> com os caminhos dos arquivos salvos. Isso acontece porque a função <code>salvar_csv_por_empresa()</code> retorna o caminho do arquivo salvo, e o <code>map()</code> retorna os resultados de cada iteração em uma lista.</p>
<p>Também poderíamos reescrever de uma forma mais direta, com o pipe (considerando que o primeiro argumento do <code>map()</code> recebe o vetor ou a lista que queremos iterar):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>voos <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(nm_empresa) <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(nm_empresa) <span class="sc">|&gt;</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(salvar_csv_por_empresa, <span class="at">dados =</span> voos)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercício-1" class="level4" data-number="7.3.2.2">
<h4 data-number="7.3.2.2" class="anchored" data-anchor-id="exercício-1"><span class="header-section-number">7.3.2.2</span> Exercício</h4>
<ol type="1">
<li>Observe o código abaixo. A função <code>criar_histograma()</code> cria um histograma para uma variável de um data frame:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>criar_histograma <span class="ot">&lt;-</span> <span class="cf">function</span>(dados, variavel){</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.data.frame</span>(dados))</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(variavel))</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  dados <span class="sc">|&gt;</span> </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[variavel]]) <span class="sc">+</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Histograma de"</span>, variavel))</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de uso:</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">criar_histograma</span>(palmerpenguins<span class="sc">::</span>penguins, <span class="st">"bill_length_mm"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="programacao-funcional_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="a">
<li>Utilize a função <code>map()</code> e a função <code>criar_histograma()</code> para criar um histograma para cada variável numérica do data frame <code>palmerpenguins::penguins</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Obter as variáveis numéricas do data frame</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Iterar com a função map() </span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="outras-aplicações" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="outras-aplicações"><span class="header-section-number">7.3.3</span> Outras aplicações</h3>
<p>Podemos utilizar as técnicas de iteração (seja com <em>loops</em> <code>for</code> ou com <code>purrr</code>) para realizar outras tarefas, como:</p>
<ul>
<li><p>Importar diversos arquivos e combinar em um único data frame. Exemplo: importar múltiplos arquivos CSV contendo dados de voos mensais e consolidá-los em uma única base.</p></li>
<li><p>Gerar documentos Quarto com parâmetros. Exemplo: gerar um relatório para cada aeroporto do Brasil.</p></li>
<li><p>Criar gráficos automaticamente para diferentes grupos ou variáveis. Exemplo: gerar histogramas para cada variável numérica de um data frame.</p></li>
<li><p>E muitas outras tarefas! Depende das nossas habilidades para criar funções e utilizar as técnicas de iteração.</p></li>
</ul>
</section>
<section id="comparação-for-loop-vs.-map" class="level3" data-number="7.3.4">
<h3 data-number="7.3.4" class="anchored" data-anchor-id="comparação-for-loop-vs.-map"><span class="header-section-number">7.3.4</span> Comparação: <code>for</code> loop vs.&nbsp;<code>map()</code></h3>
<p>Quando comparamos diferentes técnicas de iteração, como <em>loops</em> <code>for</code> e funções do <code>purrr</code>, é importante considerar:</p>
<ul>
<li><p>Eficiência de código: qual é a velocidade de execução de cada método?</p></li>
<li><p>Eficiência de programação: qual é a facilidade de escrever e manter o código?</p></li>
</ul>
<p>O tidyverse escolhe otimizar a eficiência de programação, ou seja, a facilidade de escrever e manter o código. Escrever códigos com <code>purrr</code>, no geral, é mais fácil e legível do que escrever códigos com <em>loops</em> <code>for</code>.</p>
<p>Por outro lado, <em>loops</em> <code>for</code> podem ser mais rápidos em algumas situações, especialmente quando precisamos de controle total sobre a iteração. No entanto, a diferença de desempenho entre <em>loops</em> <code>for</code> e funções do <code>purrr</code> é geralmente pequena, e a eficiência de programação geralmente supera a eficiência de código.</p>
<p>Caso você tenha interesse em medir a eficiência de código, o pacote <a href="https://bench.r-lib.org/"><code>{bench}</code></a> é uma ferramenta para medir o tempo de execução de expressões em R.</p>
<p>Vamos comparar o tempo de execução de um <em>loop</em> <code>for</code> e do<code>map()</code>, para ter um exemplo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-44"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-44-1"><a href="#annotated-cell-44-1" aria-hidden="true" tabindex="-1"></a>dados_benchmark <span class="ot">&lt;-</span> bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="1">1</button><span id="annotated-cell-44-2" class="code-annotation-target"><a href="#annotated-cell-44-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="annotated-cell-44-3"><a href="#annotated-cell-44-3" aria-hidden="true" tabindex="-1"></a>  vetor_numeros <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="annotated-cell-44-4"><a href="#annotated-cell-44-4" aria-hidden="true" tabindex="-1"></a>  quadrados <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(vetor_numeros))</span>
<span id="annotated-cell-44-5"><a href="#annotated-cell-44-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-44-6"><a href="#annotated-cell-44-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(vetor_numeros)) {</span>
<span id="annotated-cell-44-7"><a href="#annotated-cell-44-7" aria-hidden="true" tabindex="-1"></a>    quadrados[i] <span class="ot">&lt;-</span> vetor_numeros[i] <span class="sc">^</span> <span class="dv">2</span></span>
<span id="annotated-cell-44-8"><a href="#annotated-cell-44-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-44-9"><a href="#annotated-cell-44-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-44-10"><a href="#annotated-cell-44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(quadrados)</span>
<span id="annotated-cell-44-11"><a href="#annotated-cell-44-11" aria-hidden="true" tabindex="-1"></a>},</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="2">2</button><span id="annotated-cell-44-12" class="code-annotation-target"><a href="#annotated-cell-44-12" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="annotated-cell-44-13"><a href="#annotated-cell-44-13" aria-hidden="true" tabindex="-1"></a>  vetor_numeros <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="3">3</button><span id="annotated-cell-44-14" class="code-annotation-target"><a href="#annotated-cell-44-14" aria-hidden="true" tabindex="-1"></a>  quadrados <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(vetor_numeros, <span class="sc">~</span> .x <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="annotated-cell-44-15"><a href="#annotated-cell-44-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(quadrados)</span>
<span id="annotated-cell-44-16"><a href="#annotated-cell-44-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-44-17"><a href="#annotated-cell-44-17" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-44" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="2,11" data-code-annotation="1">Código com <em>loop</em> <code>for</code> para calcular o quadrado de cada número de 1 a 10, e armazenar o resultado em um vetor <code>quadrados</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="12,16" data-code-annotation="2">Código com <code>purrr</code> para calcular o quadrado de cada número de 1 a 10, e armazenar o resultado em um vetor <code>quadrados</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="14" data-code-annotation="3">Com a função <code>map_dbl()</code> (é uma variação do <code>map()</code>, porém retorna um vetor numérico)</span>
</dd>
</dl>
</div>
</div>
<p>Vamos visualizar o resultado do benchmark:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dados_benchmark)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 2 × 6</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   expression                             min median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;bch:expr&gt;                           &lt;bch&gt; &lt;bch:&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 { vetor_numeros &lt;- 1:10 quadrados &lt;… 775µs  898µs     1047.    44.8KB     33.6</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 { vetor_numeros &lt;- 1:10 quadrados &lt;…  45µs   48µs    18840.   437.7KB     16.5</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No exemplo acima, o código com <code>purrr</code> é mais rápido do que o <em>loop</em> <code>for</code>. No entanto, a diferença de desempenho é pequena, e a diferença dependerá do que está sendo feito em cada iteração (ou seja, o código que executamos).</p>
<p>O mais importante é considerar a eficiência de programação e a legibilidade do código ao escolher entre <em>loops</em> <code>for</code> e funções do <code>purrr</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Comentário interessante do Hadley Wickham, em um <a href="https://www.youtube.com/watch?v=wki0BqlztCo&amp;t=222s">seminário apresentado em Stanford</a>:</p>
<blockquote class="blockquote">
<p>“[…] what are the bottlenecks in the data analysis process? I think there are 2 main categories: first of all, you have to think about what do you want to do, figure it out what the next step is. Then you need to precisely describe it in such a way that the computer can understand what you want; in other words, you have to program it and then finally the computer has to go away and crunch some number. And in my experience, when you’re doing a data analysis, the biggest bottleneck is cognitive: you spend way more time thinking about the problem, then you do actually computing on the problem. And if that’s the bottleneck then you don’t want to choose a programming language that’s optimized for performance, it doesn’t matter if you can do this computation ten times faster if the computation takes a second, and you have to spend a minute thinking about it. You want to pick a language that helps you think about the problem, and then helps you express that in code.”</p>
</blockquote>
</div>
</div>
</section>
</section>
<section id="paralelização" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="paralelização"><span class="header-section-number">7.4</span> Paralelização</h2>
<p>Em alguns casos, precisaremos executar tarefas que são demoradas, como processar grandes volumes de dados. Até então, aprendemos a utilizar funções e técnicas de iteração para facilitar a execução de tarefas repetitivas. No entanto, em alguns casos, a execução sequencial (ou seja, uma depois da outra) dessas tarefas pode ser lenta.</p>
<p>Nesses casos, a paralelização pode ser uma estratégia útil para acelerar o processamento.</p>
<p>A paralelização é a técnica de dividir um problema em partes menores que podem ser executadas simultaneamente em diferentes núcleos do processador do computador. Isso melhora significativamente o desempenho de tarefas que envolvem grandes volumes de dados ou operações repetitivas.</p>
<p>Ou seja, utilizando o processamento paralelo, as operações são distribuídas entre múltiplos núcleos do processador e executadas simultaneamente.</p>
<section id="pacote-furrr" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="pacote-furrr"><span class="header-section-number">7.4.1</span> Pacote <code>furrr</code></h3>
<p><img src="images/logo-furrr.png" class="img-rstudio" align="right" width="120px"></p>
<p>O pacote <a href="https://furrr.futureverse.org/"><code>{furrr}</code></a> é um pacote que extende o pacote <a href="https://purrr.tidyverse.org/"><code>{purrr}</code></a> e oferece funções para executar operações em paralelo. O <code>furrr</code> é baseado no pacote <a href="https://future.futureverse.org/"><code>{future}</code></a>, que fornece uma interface unificada para processamento paralelo em R.</p>
<section id="configuração" class="level4" data-number="7.4.1.1">
<h4 data-number="7.4.1.1" class="anchored" data-anchor-id="configuração"><span class="header-section-number">7.4.1.1</span> Configuração</h4>
<p>Para configurar o processamento paralelo com o <code>furrr</code>, precisamos seguir alguns passos:</p>
<ol start="2" type="1">
<li>Configurar o plano de processamento paralelo com a função <code>future::plan()</code>.</li>
</ol>
<ul>
<li><p>argumento <code>strategy</code>: O <code>future</code> oferece diferentes planos de processamento paralelo, como <code>multisession</code> ou <code>multicore</code> (porém <code>multicore</code> não funciona no Windows). No entanto, o plano <code>multicore</code> não é suportado no RStudio, devido a problemas de estabilidade. Portanto, se você estiver utilizando o RStudio, sempre utilize o <code>multisession</code>.</p></li>
<li><p>argumento <code>workers</code>: O número de núcleos que queremos utilizar para o processamento paralelo. Uma boa prática é deixar alguns núcleos livres para o sistema operacional. Caso este argumento não seja fornecido, o <code>future</code> utilizará todos os núcleos disponíveis.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo: em um computador com 8 núcleos, podemos utilizar 6 núcleos para o processamento paralelo</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">6</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="utilizando-o-furrr" class="level4" data-number="7.4.1.2">
<h4 data-number="7.4.1.2" class="anchored" data-anchor-id="utilizando-o-furrr"><span class="header-section-number">7.4.1.2</span> Utilizando o <code>furrr</code></h4>
<p>O <code>furrr</code> oferece funções que são uma extensão das funções do <code>purrr</code>, porém com suporte a processamento paralelo. Por exemplo, a função <code>furrr::future_map()</code> é uma versão paralela da função <code>purrr::map()</code>.</p>
<p>A sintaxe da função <code>furrr::future_map()</code> é semelhante à função <code>purrr::map()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>nome_empresas <span class="ot">&lt;-</span> voos <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(nm_empresa, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span> (<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(nm_empresa)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a> furrr<span class="sc">::</span><span class="fu">future_map</span>(nome_empresas,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>           salvar_csv_por_empresa,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">dados =</span> voos) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Repare que a função <code>furrr::future_map()</code> é utilizada da mesma forma que a função <code>purrr::map()</code>, porém com suporte a processamento paralelo. Isso significa que a função <code>salvar_csv_por_empresa()</code> será executada em paralelo para cada empresa, o que pode acelerar o processamento.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>É importante avaliar o problema e a estratégia de paralelização antes de implementar o processamento paralelo. Utilizamos o processamento paralelo quando <strong>realmente</strong> precisamos acelerar a execução de tarefas.</p>
</div>
</div>
</section>
<section id="exercício-2" class="level4" data-number="7.4.1.3">
<h4 data-number="7.4.1.3" class="anchored" data-anchor-id="exercício-2"><span class="header-section-number">7.4.1.3</span> Exercício</h4>
<ol type="1">
<li>Observe o código abaixo. O que cada parte do código faz? O que o resultado de <code>df_benchmark</code> nos mostra?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dormir <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  usethis<span class="sc">::</span><span class="fu">ui_info</span>(<span class="st">"Dormindo.. {x}"</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(multisession)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df_benchmark <span class="ot">&lt;-</span> bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, dormir),</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  furrr<span class="sc">::</span><span class="fu">future_map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, dormir)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>df_benchmark</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 2 × 13</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   expression      min median `itr/sec` mem_alloc `gc/sec` n_itr</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;bch:expr&gt;    &lt;bch&gt; &lt;bch:&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 purrr::map(1… 4.96s  4.96s     0.202  115.82KB        0     1</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 furrr::futur… 1.14s  1.14s     0.879    8.32MB        0     1</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # ℹ 6 more variables: n_gc &lt;dbl&gt;, total_time &lt;bch:tm&gt;,</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co"># #   result &lt;list&gt;, memory &lt;list&gt;, time &lt;list&gt;, gc &lt;list&gt;</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="material-complementar" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="material-complementar"><span class="header-section-number">7.5</span> Material complementar</h2>
<ul>
<li>Capítulos do livro <a href="https://pt.r4ds.hadley.nz/">“R para Ciência de Dados” (2 ed)</a> por Hadley Wickham, Mine Çetinkaya-Rundel, e Garrett Grolemund:
<ul>
<li><a href="https://pt.r4ds.hadley.nz/base-R.html">Um guia para o R Base</a></li>
<li><a href="https://pt.r4ds.hadley.nz/functions.html">Funções</a></li>
<li><a href="https://pt.r4ds.hadley.nz/iteration.html">Iteração</a></li>
</ul></li>
<li>Capítulos do livro Zen do R, por <a href="https://curso-r.github.io/zen-do-r/index.html">Curso-R</a>:
<ul>
<li><a href="https://curso-r.github.io/zen-do-r/funcoes-deps.html">Funções e dependências</a></li>
</ul></li>
</ul>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>O termo “programação funcional” aqui é usado de forma simplificada. Caso queira uma definição mais detalhada, confira a <a href="https://pt.wikipedia.org/wiki/Programa%C3%A7%C3%A3o_funcional">Wikipedia</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ipeadata-lab\.github\.io\/curso_r_intermediario_202501");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./texto-data.html" class="pagination-link" aria-label="Manipulação de datas e textos">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Manipulação de datas e textos</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./dados-espaciais.html" class="pagination-link" aria-label="Dados espaciais no R">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dados espaciais no R</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>